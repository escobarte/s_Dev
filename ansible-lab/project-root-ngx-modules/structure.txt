project-root/
├── nginx-laravel-main.yml
├── prx_hosts.yml
├── vars/
│   └── main.yml
├── files/
│   └── laravel.lab.local.conf
│   └── nginx.conf	
└── roles/
    └── ngx-build-and-modules/
        └── tasks/
            └── main.yml


# --- 1. Установка зависимостей для сборки Nginx и модулей ---
	 Стандартные утилиты, библиотеки для сборки из исходников, поддержки SSL, GeoIP2, ModSecurity
# --- 2. Скачиваем и распаковываем исходники Nginx ---
# --- 4. Клонируем репозитории модулей GeoIP2 и ModSecurity ---
# --- 5. Сборка библиотеки ModSecurity ---
# --- 6. Клонируем коннектор ModSecurity для nginx ---
# --- 7. Собираем Nginx c модулями (GeoIP2, ModSecurity) ---
# --- 3. Копируем базовый nginx.conf (или твой кастомный) ---
# --- 8. Копируем скомпилированные модули в папку /etc/nginx/modules ---
# --- 9. Создаём пользователя под nginx ---
# --- 10. Создаём systemd unit для управления nginx через systemctl ---
# --- 11. Создаём стандартные папки для виртуальных хостов ---
# --- 12. Настраиваем GeoIP2: конфиг и обновление баз ---
# --- 13. Вставляем строки подключения модулей в nginx.conf ---
# --- 14. Запускаем и включаем nginx как сервис ---
# --- 15. Создаём базовый конфиг ModSecurity ---
# --- 16. Включаем строгий режим (SecRuleEngine On) ---
# --- 17. Клонируем и настраиваем OWASP CRS ---
# --- 18. Добавляем geoip2-конфиг в блок http{} nginx.conf ---
# --- 19. Копируем конфиг для виртуального хоста (laravel.lab.local) ---
# --- 20. Отключаем дефолтный сайт, включаем новый ---
# --- 21. Добавляем заголовки GeoIP2 и правила modsecurity в location / ---
# --- 22. Проверяем валидность конфигурации и перезапускаем nginx ---
