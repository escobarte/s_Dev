```bash
#!/bin/bash
# Shebang - указывает, что скрипт должен выполняться с помощью bash
# set -e означает "остановить выполнение скрипта при любой ошибке"
set -e

# Выводим информационное сообщение в консоль
echo "Запускаем Laravel приложение..."

# Создаём файл .env с настройками для production среды
# .env файл содержит все секретные настройки приложения (база данных, ключи и т.д.)
cat > /var/www/html/.env << EOF
# Название приложения
APP_NAME=Laravel
# Режим работы: production (боевой сервер, без отладочной информации)
APP_ENV=production
# Ключ шифрования (пока пустой, будет сгенерирован автоматически)
APP_KEY=
# Отключаем режим отладки (не показываем ошибки пользователям)
APP_DEBUG=false
# Часовой пояс по умолчанию
APP_TIMEZONE=UTC
# URL приложения
APP_URL=http://localhost

# Настройки базы данных: используем SQLite (файловая БД, не требует отдельного сервера)
DB_CONNECTION=sqlite
# Путь к файлу базы данных SQLite
DB_DATABASE=/var/www/html/database/database.sqlite

# Настройки кэширования: используем файловый кэш
CACHE_STORE=file
# Настройки файловой системы: локальное хранилище
FILESYSTEM_DISK=local
# Очереди: синхронное выполнение (без фоновых задач)
QUEUE_CONNECTION=sync
# Сессии: хранить в файлах
SESSION_DRIVER=file
# Время жизни сессии: 120 минут
SESSION_LIFETIME=120

# Настройки логирования и уведомлений
BROADCAST_CONNECTION=log
# Логи выводить в stderr (стандартный поток ошибок)
LOG_CHANNEL=stderr
# Использовать один файл для логов
LOG_STACK=single
# Не логировать устаревшие функции
LOG_DEPRECATIONS_CHANNEL=null
# Уровень логирования: только ошибки
LOG_LEVEL=error
EOF

# Исправляем права доступа к критически важным директориям
# chown - изменяет владельца файлов на www-data (пользователь веб-сервера)
# -R означает рекурсивно (включая все подпапки)
chown -R www-data:www-data /var/www/html/storage /var/www/html/bootstrap/cache
# chmod изменяет права доступа: 775 = владелец и группа могут все, остальные только читать/выполнять
chmod -R 775 /var/www/html/storage /var/www/html/bootstrap/cache

# Создаём SQLite базу данных
# mkdir -p создает директорию (и родительские директории если нужно)
mkdir -p /var/www/html/database
# touch создает пустой файл базы данных
touch /var/www/html/database/database.sqlite
# Устанавливаем правильного владельца для файла БД
chown www-data:www-data /var/www/html/database/database.sqlite

# Очищаем различные виды кэша Laravel
# Очищаем кэш конфигурации
php artisan config:clear
# Очищаем общий кэш приложения (|| echo означает "если команда упала, просто выведи сообщение и продолжай")
# 2>/dev/null перенаправляет ошибки в "никуда" (не показывает их пользователю)
php artisan cache:clear 2>/dev/null || echo "Не удалось очистить кэш, пропускаем..."
# Очищаем кэш скомпилированных шаблонов (views)
php artisan view:clear

# Генерируем уникальный ключ шифрования для приложения
# --no-interaction: не задавать вопросы пользователю
# --force: принудительно выполнить в production режиме
php artisan key:generate --no-interaction --force

# Запускаем миграции базы данных (создание/обновление таблиц)
# --force: выполнить в production без подтверждения
php artisan migrate --force --no-interaction 2>/dev/null || echo "Миграции не выполнены"

# Заполняем базу данных начальными данными (сиды)
php artisan db:seed --force --no-interaction 2>/dev/null || echo "Сиды не выполнены"

# Оптимизация для production среды (кэшируем конфигурации для быстрой работы)
# Кэшируем конфигурацию приложения
php artisan config:cache
# Кэшируем маршруты (routes)
php artisan route:cache
# Кэшируем скомпилированные шаблоны
php artisan view:cache

# Информационное сообщение о запуске supervisor
echo "Запускаем supervisor для управления nginx и php-fpm..."
# exec заменяет текущий процесс на supervisor
# supervisor будет управлять nginx и php-fpm согласно конфигурации
exec supervisord -c /etc/supervisord.conf
```

## Что делает этот скрипт простыми словами:

Этот скрипт — это **автоматический помощник**, который подготавливает Laravel приложение к работе в production. 

### Представьте, что вы открываете новый ресторан:

1. **Создаем меню** (`.env` файл) — записываем все настройки: что готовить, где хранить продукты, как работать
2. **Наводим порядок** — даем правильные права доступа к кухне и складу
3. **Готовим место для хранения заказов** — создаем базу данных (как журнал заказов)
4. **Убираем старую информацию** — очищаем кэш от предыдущих запусков
5. **Генерируем секретный код безопасности** — как пароль от сейфа ресторана
6. **Подготавливаем кухню** — создаем таблицы в базе данных, добавляем начальные данные
7. **Оптимизируем работу** — кэшируем часто используемые настройки для быстрой работы
8. **Открываем ресторан** — запускаем supervisor, который управляет поварами (PHP-FPM) и официантами (Nginx)

**Результат**: После выполнения скрипта у вас есть полностью готовое к работе веб-приложение, которое может обслуживать пользователей.