

# Личный DevOps-Дневник

---

## 1 Августа 2025

> Не знаю как правильно записать: продолжить с момента или описать с начала?
> 
> **В моменте:**
> На этой неделе у меня получилось собрать свой Playbook на **Ansible**, который компилирует модули **GeoIP2** и **ModSecurity**, устанавливает **Nginx** и всё это красиво прописывает в настройки.
> 
> Есть ещё многое, что нужно узнать про Ansible, но сейчас самому себя перегружать не нужно. Пока не знаю, что дальше, поэтому думаю попробовать подружиться с **GitLab**.
> 
> **Ситуация:**
> Нужно установить **Nginx Mainline 1.29** (последняя версия). Для этого:
> 
> 1. Установка Legacy 1.24
> 2. Копирование нужных файлов из него
> 3. Установка 1.29 и присваивание структуры, как у 1.24

---

## 4 Августа 2025

### Задача

1. **Собрать вручную сборку Nginx из исходников.**
   Установил Legacy-версию, чтобы скопировать часть конфигов в Mainline-версию.
   
   * ✅ Собрал успешно

2. **Собрать, установить, запустить, проверить работоспособность.**
   
   * Задача:
     
     * Установить версию **1.28.0** (main Playbook)
     * Сделать апдейт до **1.29.0** (update Playbook)

3. **Заделиверить через Playbook.**

---

**Результат:**
С самого утра пытаюсь собрать Playbook — миллиард ошибок.
Решаю начать с нуля.

---

**Задача: 8/4/2025 16:30**

1. Скачать **Nginx Mainline v1.29.0**, создать `nginx.service`
2. Собрать модули **GeoIP2** и **ModSecurity** на базе Nginx 1.29.0

Делаю шаг за шагом: пока не подтвержу работоспособность — дальше не иду.

#### Структура:

* `nginx-laravel-main.yml`
* `prx_hosts.yml`
* `/vars/main.yml`
* `/roles/ngx-build-and-modules/main.yml`

---

## 5 Августа 2025

1. Начал собирать чистую сборку, но не нравится бинарник.
   Перехожу в ручной режим.

> **Объяснение:**
> Все таски "сборка Nginx" и "build GeoIP2" делаются за один configure/make, без повторного configure!
> Удалена вторая сборка исходников, только один configure/make.
> `make clean || true` — если первый раз, не упадёт.
> Модуль гарантированно совместим.
> После этого можно сразу переходить к ModSecurity или другим модулям.
> Используй такой playbook — и “binary incompatible” исчезнет навсегда!
> Если нужны мелкие правки или разбить таски — скажи, подправлю.

---

**10:13** — Playbook собрался успешно?
Буду добавлять Laravel и проверять:

1. `/etc/nginx/nginx.conf` — добавить GeoIP2
2. Скопировать конфиг Laravel
   2.1. Создать линк на sites-enabled
3. В Laravel добавить (ModSecurity, add\_headers)

---

**Решение:**

* Прописал копирование чистого `nginx.conf` до загрузки модулей.
* Всё работает как нужно!

---

**Финалка:**
Я собрал свой **Nginx from Source Code + ModSecurity + GeoIP2**!

---

## 6 Августа 2025

1. Задал себе вопрос — как обновлять такую сборку через Playbook?

2. **Тест 1:** Установка 1.28, потом просто замена версии в vars на 1.29 — и проверка.
   
   * **8:20** — Деплой версии 1.28 прошёл успешно
   * **8:35** — Заменяю vars на 1.29, проверяю
   * **8:40** — Апдейт прошёл успешно! С 1.28 на 1.29.
     **Победа!**

---

## 7  Августа 2025

1. Берусь основательно за "Git". База и практика. Иду по предложению Chat-a.
2. Отвлекся "Как сделать WSL красивее". 
3. Этот .git = боль,  я потратил много времени на него сегодня, но - как мне кажется я понял. 
`В кратце. У нас есть main, с него все и качают. Если ты что то делаешь - добавляшь, то обязательно делаешь ветвь отдельную. И когда ты уверен что всё гуд, merge.`
