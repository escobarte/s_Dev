# HTTPS / TLS Setup with Self-Signed Certificate

## Проверка доступности порта 80 на IP '185.108.183.205'

```bash
netstat -tulnp | grep 80 | grep nginx
# Проверяем, прослушивается ли порт 80 и используется ли он процессом nginx.
```

---

##  Создание самоподписанного SSL-сертификата (т.к. Let's Encrypt не работает локально)

```bash
sudo mkdir -p /etc/ssl/app.lab.local
# Создаём директорию для хранения SSL-сертификата и ключа.

cd /etc/ssl/app.lab.local
# Переходим в созданную директорию.
```

###  Генерация ключа и сертификата

```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout app.lab.local.key \
  -out app.lab.local.crt \
  -subj "/C=MD/ST=Lab/O=Dev/CN=app.lab.local"
# Создаём самоподписанный SSL-сертификат:
# - без шифрования ключа (--nodes)
# - сроком на 365 дней
# - RSA 2048 бит
# - Указываем субъект: страна, регион, организация, домен
```

---

##  Конфигурация Nginx `/etc/nginx/sites-enabled/app-lb.conf`

```nginx
# Перенаправление HTTP -> HTTPS
server {
    listen 80 default_server;
    server_name app.lab.local;

    return 301 https://$host$request_uri;
    # Все запросы на HTTP перенаправляются на HTTPS
}

# Основной HTTPS сервер
server {
    listen 443 ssl;
    server_name app.lab.local;

    ssl_certificate /etc/ssl/app.lab.local/app.lab.local.crt;
    ssl_certificate_key /etc/ssl/app.lab.local/app.lab.local.key;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    # Используем безопасные версии TLS и сильные шифры
}
```

```bash
nginx -t
# Проверка конфигурации nginx на синтаксические ошибки

systemctl reload nginx
# Применение новой конфигурации (перезагрузка без прерывания работы)
```

---

## Настройка второго прокси `Prx02`

```bash
# Скопировать SSL-сертификат и ключ с Prx01 на Prx02
# (можно через scp или rsync)

# Добавить конфигурацию аналогичную Prx01 в файл:
nano /etc/nginx/sites-enabled/app2-lb.conf

# Проверка и перезапуск:
nginx -t
systemctl reload nginx
```