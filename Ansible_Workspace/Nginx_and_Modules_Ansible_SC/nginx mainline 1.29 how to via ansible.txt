Создаю свою сборку Nginx версии Mainline 1.29.0, через apt. 
Также пытаюсь сохранить структуру как у Legacy (1.24.0)
ШАГ 0.
### Чтобы удалить кастомную репозиторию nginx mainline из apt list.
1. Полное удаление текущего nginx
sudo systemctl stop nginx || true
sudo apt remove --purge nginx nginx-common nginx-core nginx-full nginx-module* -y
sudo apt autoremove -y
sudo rm -rf /etc/nginx /var/log/nginx /var/lib/nginx /usr/sbin/nginx
sudo rm -f /lib/systemd/system/nginx.service
2. Удали кастомные репозитории nginx mainline
ls /etc/apt/sources.list.d/
sudo rm -f /etc/apt/sources.list.d/nginx.list
sudo apt update
apt-cache policy nginx

#################################################################
ШАГ 1. Сохраняем файлы и каталоги из legacy-версии Nginx (1.24)
tar -czf /tmp/nginx_legacy_conf.tar.gz nginx.conf proxy_params fastcgi.conf fastcgi_params scgi_params uwsgi_params mime.types sites-available sites-enabled snippets
tar tzf /tmp/nginx_legacy_conf.tar.gz
### Как коприровать с Server to Local
1. Открой терминал на своей локальной машине (WSL или обычный bash).
2. Выполни:
scp scusnir@10.100.93.4:/tmp/nginx_legacy_conf.tar.gz /mnt/d/s_dev_ops/
### Копирую с локальной на сервер
scp /mnt/d/s_dev_ops/ansible-lab/nginx_legacy_conf.tar.gz scusnir@10.100.93.4:/tmp/
########################
### Сборка Version 1 ###
########################
--- Сборка и утсановка
sudo apt update
sudo apt install -y build-essential libpcre3 libpcre3-dev zlib1g zlib1g-dev libssl-dev git
cd /usr/local/src
sudo wget http://nginx.org/download/nginx-1.29.0.tar.gz
sudo tar -xzvf nginx-1.29.0.tar.gz
cd nginx-1.29.0
sudo ./configure \
  --prefix=/etc/nginx \
  --sbin-path=/usr/sbin/nginx \
  --modules-path=/usr/lib/nginx/modules \
  --conf-path=/etc/nginx/nginx.conf \
  --error-log-path=/var/log/nginx/error.log \
  --http-log-path=/var/log/nginx/access.log \
  --pid-path=/var/run/nginx.pid \
  --lock-path=/var/lock/nginx.lock \
  --with-http_ssl_module \
  --with-http_v2_module \
  --with-http_gzip_static_module
sudo make
sudo make install
nano /lib/systemd/system/nginx.service
#Можно скопировать конфиг из любого nginx.service 
sudo systemctl daemon-reload
sudo systemctl enable nginx
sudo systemctl start nginx
sudo systemctl status nginx
nginx -v
--- Копирование кофигов из Legacy в Mainline
cd /tmp/nginx_for_compile_legacy
tar -xzvf nginx_legacy_conf.tar.gz
cp -r fastcgi_params /etc/nginx/
cp -r mime.types /etc/nginx/
cp -r nginx.conf /etc/nginx/
cp -r proxy_params /etc/nginx/
cp -r scgi_params /etc/nginx/
cp -r sites-available/ /etc/nginx/
cp -r sites-enabled/ /etc/nginx/
cp -r snippets/ /etc/nginx/
cp -r uwsgi_params /etc/nginx/
--- This step is for manul checking, in ansible will be different
nano /etc/nginx/sites-available/laravel.lab.local.conf
ln -s /etc/nginx/sites-available/laravel.lab.local.conf /etc/nginx/sites-enabled/
nginx -t
systemctl restart nginx
